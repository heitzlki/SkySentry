# Caddy listens on port 9999 (internal) for Cloudflare tunnel
:9999

# Main web dashboard (Next.js)
app.demo-arch.shivi.io {
  reverse_proxy localhost:3000
}

# WebRTC capture interface (React/Vite)
capture.demo-arch.shivi.io {
  reverse_proxy localhost:5173
}

# WebSocket server for WebRTC signaling
ws.demo-arch.shivi.io {
  reverse_proxy localhost:8080 {
    # Enable WebSocket support
    header_up Connection {>Connection}
    header_up Upgrade {>Upgrade}
  }
}

# API endpoints (Elysia server)
api.demo-arch.shivi.io {
  reverse_proxy localhost:3001
}

# Redis Insight dashboard (optional - for development/debugging)
redis.demo-arch.shivi.io {
  reverse_proxy localhost:5540
}

# Alternative configuration if you want everything under one domain with paths:
# example.com {
#   # Main dashboard at root
#   reverse_proxy / localhost:3000
#   
#   # Capture interface
#   reverse_proxy /capture/* localhost:5173
#   
#   # API endpoints
#   reverse_proxy /api/* localhost:3001
#   
#   # WebSocket endpoint
#   reverse_proxy /ws localhost:8080 {
#     header_up Connection {>Connection}
#     header_up Upgrade {>Upgrade}
#   }
#   
#   # Redis Insight
#   reverse_proxy /redis/* localhost:5540
# }